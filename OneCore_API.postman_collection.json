{
	"info": {
		"_postman_id": "onecore-api-collection",
		"name": "OneCore API - Evaluaci√≥n T√©cnica",
		"description": "Colecci√≥n completa de APIs para OneCore seg√∫n EVALUACION_TECNICA.txt y EVALUACION_TECNICA_V2.txt\n\n**PARTE 1: APIs (EVALUACION_TECNICA.txt)**\n\n1. ‚úÖ API de Inicio de Sesi√≥n (Session Login API)\n   - Endpoint para usuarios an√≥nimos\n   - JWT firmado con id_usuario y rol\n   - Expiraci√≥n de 15 minutos\n\n2. ‚úÖ API de Carga y Validaci√≥n de Archivos (File Upload and Validation API)\n   - Subida a AWS S3\n   - Almacenamiento en SQL Server\n   - Validaci√≥n (valores vac√≠os, tipos incorrectos, duplicados)\n   - Control de acceso por rol con JWT\n\n3. ‚úÖ API de Renovaci√≥n de Token (Token Renewal API)\n   - Renueva JWT con tiempo adicional\n   - Solo si el token original no ha expirado\n\n**PARTE 2: M√≥dulos Web (EVALUACION_TECNICA_V2.txt)**\n\n4. ‚úÖ API de Documentos (FASE 1-3 COMPLETA)\n   - POST /api/v1/documents/upload - Subir documentos (PDF, JPG, PNG)\n   - GET /api/v1/documents - Listar documentos con filtros\n   - GET /api/v1/documents/{id} - Obtener documento por ID\n   - ‚úÖ FASE 2: Clasificaci√≥n autom√°tica (FACTURA/INFORMACI√ìN) con AWS Textract\n   - ‚úÖ FASE 3: Extracci√≥n de datos estructurados (Facturas e Informaci√≥n)\n\n5. ‚úÖ API de Historial (FASE 4 COMPLETA)\n   - GET /api/v1/history - Listar eventos con filtros avanzados\n   - GET /api/v1/history/export - Exportar historial a Excel",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "onecore-api"
	},
	"item": [
		{
			"name": "Health & Info",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Verifica el estado de la aplicaci√≥n"
					},
					"response": []
				},
				{
					"name": "Root Endpoint",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								""
							]
						},
						"description": "Informaci√≥n general de la API"
					},
					"response": []
				}
			],
			"description": "Endpoints p√∫blicos sin autenticaci√≥n"
		},
		{
			"name": "1. API de Inicio de Sesi√≥n",
					"item": [
						{
							"name": "Login - Sin rol (default gestor)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {",
											"    var jsonData = pm.response.json();",
											"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"user_id\", jsonData.user.id_usuario);",
									"    pm.environment.set(\"user_rol\", jsonData.user.rol);",
									"    console.log(\"‚úÖ Token guardado en variable de entorno\");",
									"    console.log(\"Usuario ID: \" + jsonData.user.id_usuario);",
									"    console.log(\"Rol: \" + jsonData.user.rol);",
									"    console.log(\"Expira en: \" + jsonData.expires_in + \" segundos\");",
									"    ",
									"    // Validar estructura del JWT",
									"    pm.test(\"Token contiene id_usuario\", function() {",
									"        pm.expect(jsonData.user).to.have.property(\"id_usuario\");",
									"    });",
									"    ",
									"    pm.test(\"Token contiene rol\", function() {",
									"        pm.expect(jsonData.user).to.have.property(\"rol\");",
									"    });",
									"    ",
									"    pm.test(\"Token type es bearer\", function() {",
									"        pm.expect(jsonData.token_type).to.eql(\"bearer\");",
									"    });",
									"    ",
									"    pm.test(\"Expiraci√≥n es 15 minutos (900 segundos)\", function() {",
									"        pm.expect(jsonData.expires_in).to.eql(900);",
									"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"auth",
										"login"
									]
								},
						"description": "**REQUISITO 1: API DE INICIO DE SESI√ìN**\n\nEndpoint que permite a usuarios an√≥nimos iniciar sesi√≥n.\n\n**Caracter√≠sticas:**\n- ‚úÖ Devuelve JWT firmado\n- ‚úÖ JWT contiene: `id_usuario` (user_id)\n- ‚úÖ JWT contiene: `rol` (role)\n- ‚úÖ Tiempo de expiraci√≥n: **15 minutos** (900 segundos)\n\n**Body opcional:**\n- Puede enviarse `{}` o `null`\n- Si no se especifica rol, por defecto es `\"gestor\"`\n\n**Respuesta:**\n```json\n{\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"token_type\": \"bearer\",\n    \"expires_in\": 900,\n    \"user\": {\n        \"id_usuario\": 1,\n        \"rol\": \"gestor\"\n    }\n}\n```\n\n**Nota:** El token se guarda autom√°ticamente en la variable de entorno `access_token`"
							},
							"response": []
						},
						{
							"name": "Login - Con rol admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {",
											"    var jsonData = pm.response.json();",
											"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"user_id\", jsonData.user.id_usuario);",
									"    pm.environment.set(\"user_rol\", jsonData.user.rol);",
									"    console.log(\"‚úÖ Token guardado (rol admin)\");",
									"    ",
									"    pm.test(\"Rol es admin\", function() {",
									"        pm.expect(jsonData.user.rol).to.eql(\"admin\");",
									"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"rol\": \"admin\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"auth",
										"login"
									]
								},
						"description": "Login con rol **admin**.\n\n**Importante:** El rol `admin` es necesario para acceder al endpoint de carga de archivos CSV."
							},
							"response": []
						},
						{
							"name": "Login - Con rol gestor",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {",
											"    var jsonData = pm.response.json();",
											"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"user_id\", jsonData.user.id_usuario);",
									"    pm.environment.set(\"user_rol\", jsonData.user.rol);",
									"    console.log(\"‚úÖ Token guardado (rol gestor)\");",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"rol\": \"gestor\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"auth",
										"login"
									]
								},
						"description": "Login con rol **gestor** (expl√≠cito).\n\nEquivalente a no enviar el par√°metro rol."
					},
					"response": []
				}
			],
			"description": "**REQUISITO 1: API DE INICIO DE SESI√ìN (Session Login API)**\n\nImplementa un endpoint que permita a usuarios an√≥nimos iniciar sesi√≥n.\n\n**Requisitos cumplidos:**\n- ‚úÖ Endpoint para usuarios an√≥nimos\n- ‚úÖ Devuelve JWT firmado\n- ‚úÖ JWT contiene: `id_usuario` (user_id)\n- ‚úÖ JWT contiene: `rol` (role)\n- ‚úÖ Tiempo de expiraci√≥n de **15 minutos**"
		},
		{
			"name": "2. API de Carga y Validaci√≥n de Archivos",
			"item": [
				{
					"name": "Upload CSV File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    ",
									"    pm.test(\"Upload exitoso\", function() {",
									"        pm.expect(jsonData.success).to.be.true;",
									"    });",
									"    ",
									"    pm.test(\"Contiene filename (con timestamp)\", function() {",
									"        pm.expect(jsonData).to.have.property(\"filename\");",
									"        // El filename debe incluir timestamp para evitar duplicados",
									"    });",
									"    ",
									"    pm.test(\"Contiene original_filename\", function() {",
									"        pm.expect(jsonData).to.have.property(\"original_filename\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene rows_processed\", function() {",
									"        pm.expect(jsonData).to.have.property(\"rows_processed\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene validation_errors\", function() {",
									"        pm.expect(jsonData).to.have.property(\"validation_errors\");",
									"        pm.expect(jsonData.validation_errors).to.be.an(\"array\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene param1 y param2\", function() {",
									"        pm.expect(jsonData).to.have.property(\"param1\");",
									"        pm.expect(jsonData).to.have.property(\"param2\");",
									"    });",
									"    ",
									"    if (jsonData.validation_errors.length > 0) {",
									"        console.log(\"‚ö†Ô∏è Errores de validaci√≥n encontrados:\");",
									"        jsonData.validation_errors.forEach(function(error) {",
									"            console.log(\"  - \" + error.type + \": \" + error.message);",
									"        });",
									"    } else {",
									"        console.log(\"‚úÖ Archivo validado sin errores\");",
									"    }",
									"    ",
									"    if (jsonData.s3_key) {",
									"        console.log(\"‚úÖ Archivo subido a S3: \" + jsonData.s3_key);",
									"    } else {",
									"        console.log(\"‚ö†Ô∏è S3 no configurado, archivo guardado solo en BD\");",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text",
								"description": "JWT token obtenido del endpoint de login"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": [],
									"description": "Archivo CSV a subir. Debe ser formato CSV v√°lido."
								},
								{
									"key": "param1",
									"value": "value1",
									"type": "text",
									"description": "Primer par√°metro adicional (obligatorio)"
								},
								{
									"key": "param2",
									"value": "value2",
									"type": "text",
									"description": "Segundo par√°metro adicional (obligatorio)"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/v1/files/upload",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"files",
								"upload"
							]
						},
						"description": "**REQUISITO 2: API DE CARGA Y VALIDACI√ìN DE ARCHIVOS**\n\nEndpoint para subir un archivo CSV junto con dos par√°metros adicionales.\n\n**REQUISITOS DEL ENDPOINT:**\n\n**a) Subida a AWS S3:** ‚úÖ\n- El archivo se almacena en un bucket configurado\n- Ruta: `uploads/YYYY/MM/DD/filename_timestamp.csv`\n- **Nombres √∫nicos:** Se agrega timestamp `_ddmmyyyyhhmmss` al nombre para evitar duplicados\n- Si S3 no est√° configurado, el archivo se guarda solo en la base de datos\n\n**b) Almacenamiento en SQL Server:** ‚úÖ\n- El contenido del archivo se procesa y guarda en la base de datos\n- Metadatos en tabla `file_uploads` (incluye `has_errors` y `error_count`)\n- Datos de cada fila en tabla `file_data` (como JSON)\n- Errores de validaci√≥n en tabla `file_validation_errors`\n\n**c) Validaci√≥n:** ‚úÖ\n- Devuelve una lista con las validaciones aplicadas al archivo:\n  - **Valores vac√≠os:** Detecta campos vac√≠os en cualquier fila\n  - **Tipos incorrectos:** Valida formato de emails, n√∫meros, fechas\n  - **Duplicados:** Detecta filas duplicadas\n- Los errores se guardan en BD para consulta posterior\n\n**d) Control de acceso:** ‚úÖ\n- El acceso est√° limitado a usuarios con rol espec√≠fico (por defecto: `admin`)\n- Valida el token JWT en el header `Authorization`\n- Si el usuario no tiene el rol requerido, retorna 403 Forbidden\n\n**Ejemplo de respuesta exitosa:**\n```json\n{\n    \"success\": true,\n    \"message\": \"File uploaded successfully to S3 and database\",\n    \"filename\": \"data_18122025201153.csv\",\n    \"original_filename\": \"data.csv\",\n    \"s3_key\": \"uploads/2025/12/18/data_18122025201153.csv\",\n    \"s3_bucket\": \"onecore-uploads-dev\",\n    \"rows_processed\": 100,\n    \"validation_errors\": [],\n    \"param1\": \"value1\",\n    \"param2\": \"value2\"\n}\n```\n\n**Ejemplo de respuesta con errores de validaci√≥n:**\n```json\n{\n    \"success\": true,\n    \"message\": \"File uploaded successfully to S3 and database\",\n    \"filename\": \"data_18122025201153.csv\",\n    \"original_filename\": \"data.csv\",\n    \"s3_key\": \"uploads/2025/12/18/data_18122025201153.csv\",\n    \"s3_bucket\": \"onecore-uploads-dev\",\n    \"rows_processed\": 95,\n    \"validation_errors\": [\n        {\n            \"type\": \"empty_value\",\n            \"field\": \"email\",\n            \"message\": \"Empty value in field 'email'\",\n            \"row\": 5\n        },\n        {\n            \"type\": \"incorrect_type\",\n            \"field\": \"age\",\n            \"message\": \"Invalid number format in field 'age': 'abc'\",\n            \"row\": 10\n        },\n        {\n            \"type\": \"duplicate\",\n            \"field\": null,\n            \"message\": \"Duplicate row detected. Row 15 is identical to row 8\",\n            \"row\": 15\n        }\n    ],\n    \"param1\": \"value1\",\n    \"param2\": \"value2\"\n}\n```\n\n**Mejoras implementadas:**\n- ‚úÖ **Nombres √∫nicos:** `filename` incluye timestamp para evitar duplicados\n- ‚úÖ **Tracking de errores:** Errores guardados en `file_validation_errors`\n- ‚úÖ **Metadatos mejorados:** `has_errors` y `error_count` en `file_uploads`\n- ‚úÖ **Nombre original:** `original_filename` preserva el nombre original del archivo\n\n**Nota:** Aseg√∫rate de hacer login con rol `admin` antes de usar este endpoint."
					},
					"response": []
				}
			],
			"description": "**REQUISITO 2: API DE CARGA Y VALIDACI√ìN DE ARCHIVOS (File Upload and Validation API)**\n\nEndpoint para subir un archivo CSV junto con dos par√°metros adicionales.\n\n**Requisitos cumplidos:**\n- ‚úÖ **a) Subida a AWS S3:** El archivo se almacena en un bucket configurado con nombres √∫nicos (timestamp)\n- ‚úÖ **b) Almacenamiento en SQL Server:** El contenido se procesa y guarda en la base de datos con tracking de errores\n- ‚úÖ **c) Validaci√≥n:** Devuelve lista con validaciones (valores vac√≠os, tipos incorrectos, duplicados)\n- ‚úÖ **d) Control de acceso:** Limitado a usuarios con rol espec√≠fico, validando el token JWT\n\n**Mejoras adicionales:**\n- ‚úÖ Nombres √∫nicos de archivos con timestamp (`_ddmmyyyyhhmmss`)\n- ‚úÖ Sistema de tracking de errores en BD (`file_validation_errors`)\n- ‚úÖ Campos `has_errors` y `error_count` en `file_uploads`"
		},
		{
			"name": "3. API de Renovaci√≥n de Token",
			"item": [
				{
					"name": "Renew Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"‚úÖ Token renovado exitosamente\");",
									"    console.log(\"Nuevo tiempo de expiraci√≥n: \" + jsonData.expires_in + \" segundos\");",
									"    ",
									"    pm.test(\"Token renovado\", function() {",
									"        pm.expect(jsonData).to.have.property(\"access_token\");",
									"        pm.expect(jsonData.access_token).to.not.be.empty;",
									"    });",
									"    ",
									"    pm.test(\"Token type es bearer\", function() {",
									"        pm.expect(jsonData.token_type).to.eql(\"bearer\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene informaci√≥n de usuario\", function() {",
									"        pm.expect(jsonData).to.have.property(\"user\");",
									"        pm.expect(jsonData.user).to.have.property(\"id_usuario\");",
									"        pm.expect(jsonData.user).to.have.property(\"rol\");",
									"    });",
									"} else if (pm.response.code === 401) {",
									"    console.log(\"‚ùå Error: Token expirado o inv√°lido\");",
									"    console.log(\"Debes hacer login nuevamente\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text",
								"description": "JWT token actual (debe estar vigente, no expirado)"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/auth/renew",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"renew"
							]
						},
						"description": "**REQUISITO 3: API DE RENOVACI√ìN DE TOKEN (Token Renewal API)**\n\nImplementa un endpoint para renovar el JWT, generando un nuevo token con un tiempo de expiraci√≥n adicional.\n\n**Requisitos cumplidos:**\n- ‚úÖ Endpoint para renovar el JWT\n- ‚úÖ Genera un nuevo token con tiempo de expiraci√≥n adicional (30 minutos por defecto)\n- ‚úÖ **Solo puede ser accedido si el token original a√∫n no ha expirado**\n\n**Funcionamiento:**\n1. Valida que el token en el header `Authorization` no haya expirado\n2. Si el token es v√°lido, genera un nuevo token con los mismos datos del usuario\n3. El nuevo token tiene un tiempo de expiraci√≥n adicional (30 minutos por defecto)\n4. Si el token original expir√≥, retorna error 401 Unauthorized\n\n**Ejemplo de respuesta exitosa:**\n```json\n{\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"token_type\": \"bearer\",\n    \"expires_in\": 1800,\n    \"user\": {\n        \"id_usuario\": 1,\n        \"rol\": \"admin\"\n    }\n}\n```\n\n**Ejemplo de error (token expirado):**\n```json\n{\n    \"detail\": \"Token has expired. Cannot renew expired token.\"\n}\n```\n\n**Nota:** El nuevo token se guarda autom√°ticamente en la variable de entorno `access_token`"
					},
					"response": []
				}
			],
			"description": "**REQUISITO 3: API DE RENOVACI√ìN DE TOKEN (Token Renewal API)**\n\nImplementa un endpoint para renovar el JWT, generando un nuevo token con un tiempo de expiraci√≥n adicional.\n\n**Requisitos cumplidos:**\n- ‚úÖ Endpoint para renovar el JWT\n- ‚úÖ Genera un nuevo token con tiempo de expiraci√≥n adicional\n- ‚úÖ Solo puede ser accedido si el token original a√∫n no ha expirado"
		},
		{
			"name": "4. API de Documentos (FASE 1)",
			"item": [
				{
					"name": "Upload Document",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    ",
									"    pm.test(\"Upload exitoso\", function() {",
									"        pm.expect(jsonData.success).to.be.true;",
									"    });",
									"    ",
									"    pm.test(\"Contiene document_id\", function() {",
									"        pm.expect(jsonData).to.have.property(\"document_id\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene filename con timestamp\", function() {",
									"        pm.expect(jsonData).to.have.property(\"filename\");",
									"        // El filename debe incluir timestamp para evitar duplicados",
									"    });",
									"    ",
									"    pm.test(\"Contiene original_filename\", function() {",
									"        pm.expect(jsonData).to.have.property(\"original_filename\");",
									"    });",
									"    ",
									"    if (jsonData.document_id) {",
									"        pm.environment.set(\"last_document_id\", jsonData.document_id);",
									"        console.log(\"‚úÖ Document ID guardado: \" + jsonData.document_id);",
									"    }",
									"    ",
									"    if (jsonData.s3_key) {",
									"        console.log(\"‚úÖ Documento subido a S3: \" + jsonData.s3_key);",
									"    } else {",
									"        console.log(\"‚ö†Ô∏è S3 no configurado, documento guardado solo en BD\");",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text",
								"description": "JWT token obtenido del endpoint de login"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": [],
									"description": "Archivo PDF, JPG o PNG a subir. Formatos permitidos: .pdf, .jpg, .jpeg, .png"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/v1/documents/upload",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"documents",
								"upload"
							]
						},
						"description": "**FASE 1: API DE CARGA DE DOCUMENTOS**\n\nEndpoint para subir documentos en formato PDF, JPG o PNG.\n\n**Caracter√≠sticas:**\n- ‚úÖ Valida formato (PDF, JPG, PNG)\n- ‚úÖ Genera nombre √∫nico con timestamp (`_ddmmyyyyhhmmss`)\n- ‚úÖ Sube a AWS S3 (si est√° configurado)\n- ‚úÖ Guarda metadatos en Base de Datos\n- ‚úÖ Registra evento de upload\n\n**Ejemplo de respuesta exitosa:**\n```json\n{\n    \"success\": true,\n    \"message\": \"Document uploaded successfully to S3 and database\",\n    \"document_id\": 1,\n    \"filename\": \"invoice_18122025201153.pdf\",\n    \"original_filename\": \"invoice.pdf\",\n    \"s3_key\": \"documents/2025/12/18/invoice_18122025201153.pdf\",\n    \"s3_bucket\": \"onecore-uploads-dev\",\n    \"classification\": null,\n    \"extracted_data\": null,\n    \"processing_time_ms\": null\n}\n```\n\n**Nota:**\n- El `document_id` se guarda autom√°ticamente en la variable `last_document_id`\n- La clasificaci√≥n ser√° `null` hasta implementar FASE 2\n- Los datos extra√≠dos ser√°n `null` hasta implementar FASE 3"
					},
					"response": []
				},
				{
					"name": "List Documents",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    ",
									"    pm.test(\"Listado exitoso\", function() {",
									"        pm.expect(jsonData).to.have.property(\"total\");",
									"        pm.expect(jsonData).to.have.property(\"documents\");",
									"        pm.expect(jsonData.documents).to.be.an(\"array\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene paginaci√≥n\", function() {",
									"        pm.expect(jsonData).to.have.property(\"page\");",
									"        pm.expect(jsonData).to.have.property(\"limit\");",
									"    });",
									"    ",
									"    console.log(\"‚úÖ Total de documentos: \" + jsonData.total);",
									"    console.log(\"üìÑ Documentos en esta p√°gina: \" + jsonData.documents.length);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text",
								"description": "JWT token obtenido del endpoint de login"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/documents?page=1&limit=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"documents"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"description": "N√∫mero de p√°gina (default: 1)"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Items por p√°gina (default: 20, max: 100)"
								},
								{
									"key": "classification",
									"value": "",
									"description": "Filtrar por clasificaci√≥n (FACTURA, INFORMACI√ìN)",
									"disabled": true
								},
								{
									"key": "date_from",
									"value": "",
									"description": "Fecha desde (YYYY-MM-DD)",
									"disabled": true
								},
								{
									"key": "date_to",
									"value": "",
									"description": "Fecha hasta (YYYY-MM-DD)",
									"disabled": true
								}
							]
						},
						"description": "**FASE 1: API DE LISTADO DE DOCUMENTOS**\n\nEndpoint para listar documentos con filtros y paginaci√≥n.\n\n**Filtros disponibles:**\n- `classification`: Filtrar por tipo (FACTURA, INFORMACI√ìN)\n- `date_from`: Fecha desde (YYYY-MM-DD)\n- `date_to`: Fecha hasta (YYYY-MM-DD)\n- `page`: N√∫mero de p√°gina (default: 1)\n- `limit`: Items por p√°gina (default: 20, max: 100)\n\n**Ejemplo de respuesta:**\n```json\n{\n    \"total\": 50,\n    \"page\": 1,\n    \"limit\": 20,\n    \"documents\": [\n        {\n            \"id\": 1,\n            \"filename\": \"invoice_18122025201153.pdf\",\n            \"original_filename\": \"invoice.pdf\",\n            \"file_type\": \"PDF\",\n            \"classification\": null,\n            \"uploaded_at\": \"2025-12-18T20:11:53\",\n            \"processed_at\": null,\n            \"extracted_data\": null,\n            \"s3_key\": \"documents/2025/12/18/invoice_18122025201153.pdf\",\n            \"s3_bucket\": \"onecore-uploads-dev\",\n            \"file_size\": 245760\n        }\n    ]\n}\n```\n\n**Nota:** Los documentos se ordenan por fecha de upload (m√°s recientes primero)"
					},
					"response": []
				},
				{
					"name": "Get Document by ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    ",
									"    pm.test(\"Documento obtenido\", function() {",
									"        pm.expect(jsonData).to.have.property(\"id\");",
									"        pm.expect(jsonData).to.have.property(\"filename\");",
									"        pm.expect(jsonData).to.have.property(\"file_type\");",
									"    });",
									"    ",
									"    pm.test(\"Contiene metadatos\", function() {",
									"        pm.expect(jsonData).to.have.property(\"uploaded_at\");",
									"    });",
									"    ",
									"    console.log(\"‚úÖ Documento ID: \" + jsonData.id);",
									"    console.log(\"üìÑ Archivo: \" + jsonData.original_filename);",
									"    if (jsonData.extracted_data) {",
									"        console.log(\"üìä Datos extra√≠dos disponibles\");",
									"    } else {",
									"        console.log(\"‚ö†Ô∏è Datos extra√≠dos a√∫n no disponibles (FASE 3)\");",
									"    }",
									"} else if (pm.response.code === 404) {",
									"    console.log(\"‚ùå Documento no encontrado\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text",
								"description": "JWT token obtenido del endpoint de login"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/documents/{{last_document_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"documents",
								"{{last_document_id}}"
							],
							"description": "Usa el ID del √∫ltimo documento subido. Tambi√©n puedes usar un ID espec√≠fico."
						},
						"description": "**FASE 1: API DE OBTENER DOCUMENTO POR ID**\n\nEndpoint para obtener un documento espec√≠fico por su ID.\n\n**Ejemplo de respuesta:**\n```json\n{\n    \"id\": 1,\n    \"filename\": \"invoice_18122025201153.pdf\",\n    \"original_filename\": \"invoice.pdf\",\n    \"file_type\": \"PDF\",\n    \"classification\": null,\n    \"uploaded_at\": \"2025-12-18T20:11:53\",\n    \"processed_at\": null,\n    \"extracted_data\": null,\n    \"s3_key\": \"documents/2025/12/18/invoice_18122025201153.pdf\",\n    \"s3_bucket\": \"onecore-uploads-dev\",\n    \"file_size\": 245760\n}\n```\n\n**Nota:**\n- Usa `{{last_document_id}}` para obtener el √∫ltimo documento subido\n- O reemplaza con un ID espec√≠fico\n- Retorna 404 si el documento no existe"
					},
					"response": []
				}
			],
			"description": "**M√ìDULO DE DOCUMENTOS (FASE 1-3 COMPLETA)**\n\nAPIs para el m√≥dulo de an√°lisis de documentos.\n\n**APIs implementadas:**\n- ‚úÖ POST /api/v1/documents/upload - Subir documentos (PDF, JPG, PNG)\n- ‚úÖ GET /api/v1/documents - Listar documentos con filtros\n- ‚úÖ GET /api/v1/documents/{id} - Obtener documento por ID\n\n**Caracter√≠sticas:**\n- ‚úÖ Subida a S3 y Base de Datos\n- ‚úÖ Nombres √∫nicos con timestamp\n- ‚úÖ Filtros y paginaci√≥n\n- ‚úÖ Registro de eventos\n- ‚úÖ FASE 2: Clasificaci√≥n autom√°tica (FACTURA/INFORMACI√ìN) con AWS Textract\n- ‚úÖ FASE 3: Extracci√≥n de datos estructurados\n  - Facturas: Cliente, Proveedor, Productos, Totales\n  - Informaci√≥n: Descripci√≥n, Resumen, Sentimiento (OpenAI)"
		},
		{
			"name": "5. API de Historial (FASE 4)",
			"item": [
				{
					"name": "Get History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.test(\"Historial obtenido\", function() {",
									"        pm.expect(jsonData).to.have.property(\"events\");",
									"        pm.expect(jsonData).to.have.property(\"total\");",
									"        pm.expect(jsonData.events).to.be.an(\"array\");",
									"    });",
									"    pm.test(\"Contiene paginaci√≥n\", function() {",
									"        pm.expect(jsonData).to.have.property(\"page\");",
									"        pm.expect(jsonData).to.have.property(\"page_size\");",
									"        pm.expect(jsonData).to.have.property(\"total_pages\");",
									"    });",
									"    console.log(\"‚úÖ Total de eventos: \" + jsonData.total);",
									"    console.log(\"üìÑ Eventos en esta p√°gina: \" + jsonData.events.length);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/history?page=1&page_size=50",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "history"],
							"query": [
								{"key": "page", "value": "1"},
								{"key": "page_size", "value": "50"},
								{"key": "event_type", "value": "", "disabled": true},
								{"key": "classification", "value": "", "disabled": true}
							]
						},
						"description": "**FASE 4: API DE HISTORIAL**\n\nListar eventos con filtros avanzados y paginaci√≥n.\n\n**Filtros:** event_type, document_id, user_id, classification, date_from, date_to, description_search"
					},
					"response": []
				},
				{
					"name": "Export History to Excel",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    pm.test(\"Exportaci√≥n exitosa\", function() {",
									"        pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"spreadsheetml\");",
									"    });",
									"    console.log(\"‚úÖ Archivo Excel generado\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/history/export?include_document_details=true",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "history", "export"],
							"query": [
								{"key": "include_document_details", "value": "true"}
							]
						},
						"description": "**FASE 4: EXPORTACI√ìN A EXCEL**\n\nExporta historial de eventos a archivo Excel (.xlsx)."
					},
					"response": []
				}
			],
			"description": "**FASE 4: M√ìDULO HIST√ìRICO**\n\nAPIs para historial de eventos.\n\n- ‚úÖ GET /api/v1/history - Listar eventos con filtros\n- ‚úÖ GET /api/v1/history/export - Exportar a Excel"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Pre-request script global",
					"// Verificar que base_url est√© configurado",
					"if (!pm.environment.get(\"base_url\")) {",
					"    pm.environment.set(\"base_url\", \"http://localhost:8000\");",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Test script global",
					"// Validaciones generales para todas las respuestas"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string",
			"description": "URL base de la API. Por defecto: http://localhost:8000"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string",
			"description": "JWT token de autenticaci√≥n. Se actualiza autom√°ticamente al hacer login."
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string",
			"description": "ID del usuario actual. Se actualiza autom√°ticamente al hacer login."
		},
		{
			"key": "user_rol",
			"value": "",
			"type": "string",
			"description": "Rol del usuario actual (admin o gestor). Se actualiza autom√°ticamente al hacer login."
		},
		{
			"key": "last_document_id",
			"value": "",
			"type": "string",
			"description": "ID del √∫ltimo documento subido. Se actualiza autom√°ticamente al subir un documento."
		}
	]
}
